<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="icon" type="image/png" href="../_style/images/logo.png" />
    <link rel="stylesheet" media="screen" href="../_style/app.screen.css?v=1">
    <link rel="stylesheet" media="screen" href="../_style/survey.screen.css?v=1.1">
    <title>Community Needs Assessment Survey Tool</title>
  </head>
  <body>
  <header class="withLink">
    <h1>Community Needs Assessment Survey Tool</h1>
    <a href="./exit">&times;</a>
  </header>
  <main>
    <p class="init">Loading...</p>
    <div class="consent hidden">
      <div class="content">
        <p id="surveyDescription"></p>
        <h2>Consent for participation</h2>
        <details>
          <summary>Click here to see what you're consenting to</summary>
          <ul>
            <li>I voluntarily agree to participate in this community needs assessment survey.</li>
            <li>I understand that I am participating in this survey of my own free will.</li>
            <li>I also understand that I should not expect any financial gain, remuneration or benefit directly for participation in this survey.</li>
            <li>I understand that all information I provide in this survey will be treated confidentially and no personal information will be shared.</li>
            <li>I understand that in the findings and results of this survey  my identity will remain anonymous.</li>
            <li>I understand that my participation in this survey will in no way advantage or disadvantage me in future engagements with the organisation.</li>
            <li>I understand that as the information will be stored anonymously,  I may not be able to access my specific responses.</li>
            <li>I understand that participating in this survey does not mean that I will expect any action to be taken from the organisation based on my responses and feedback.</li>
          </ul>
        </details>
        <form>
          <label><input type="checkbox" name="giveConsent" required/>I understand and consent to the above</label>
          <button type="submit" id="giveConsent">Start survey</button>
        </form>
      </div>
    </div>
    <form class="survey hidden" name="survey" action="/api/survey" method="POST">
      <input type="hidden" name="consent" value="true" />
      <input type="hidden" name="survey" value="wp-three-two" />
      <input type="hidden" name="mineDocId" />
      <input type="hidden" name="linkDocId" />
      <input type="hidden" name="linkId" />
      <div id="preQuestion"><p>Loading questions...</p></div>
      <div class="questions hidden"></div>
      <div class="unrelatedSubViews"></div>
      <button type="submit">Submit</button>
    </form>
    <template id="modal">
      <div class="modal close">
        <embed />
      </div>
    </template>
    <template id="answer-subView-link">
      <p></p>
      <a href="" target="_blank"></a>
    </template>
    <template id="question-type-single-select">
      <div class="question">
        <p class="question-number"></p>
        <fieldset class="radioGroup">
          <legend>
            <span class="question-title"></span>
            <span class="sub question-subtitle"></span>
            <img style="margin:10px auto;border-radius:10px;" src="" />
          </legend>
          <div class="answers"></div>
        </fieldset>
      </div>
      <template id="answer">
        <label>
          <input type="radio" value="" name="" />
          <span class="answer-title"></span>
        </label>
      </template>
    </template>
    <template id="question-type-multi-select">
      <div class="question">
        <p class="question-number"></p>
        <span class="question-title"></span>
        <span class="sub question-subtitle"></span>
        <img style="margin:10px auto;border-radius:10px;" src="" />
        <div class="answers multiple"></div>
      </div>
      <template id="answer">
        <label class="selector">
          <input type="checkbox" value="" name="" />
          <span></span>
        </label>
      </template>
    </template>
    <template id="question-type-number-rating">
      <div class="question">
        <p class="question-number"></p>
        <span class="question-title"></span>
        <span class="sub question-subtitle"></span>
        <img style="margin:10px auto;border-radius:10px;" src="" />
        <div class="answers numberRating lrg">
          <input type="radio" id="" class="hidden" name="" value="1" />
          <input type="radio" id="" class="hidden" name="" value="2" />
          <input type="radio" id="" class="hidden" name="" value="3" />
          <input type="radio" id="" class="hidden" name="" value="4" />
          <input type="radio" id="" class="hidden" name="" value="5" />
          <label for="1"></label>
          <label for="2"></label>
          <label for="3"></label>
          <label for="4"></label>
          <label for="5"></label>
        </div>
      </div>
    </template>
    <template id="question-type-date">
      <div class="question">
        <p class="question-number"></p>
        <span class="question-title"></span>
        <span class="sub question-subtitle"></span>
        <img style="margin:10px auto;border-radius:10px;" src="" />
        <input type="date" name="" />
      </div>
    </template>
    <template id="question-type-open-text">
      <div class="question">
        <p class="question-number"></p>
        <span class="question-title"></span>
        <span class="sub question-subtitle"></span>
        <img style="margin:10px auto;border-radius:10px;" src="" />
        <textarea name=""></textarea>
      </div>
    </template>
    <template id="question-type-dropdown">
      <div class="question">
        <p class="question-number"></p>
        <label>
          <span class="question-title"></span>
          <span class="sub question-subtitle"></span>
          <img style="margin:10px auto;border-radius:10px;" src="" />
          <select name="">
            <option value="">Select an option</option>
          </select>
        </label>
      </div>
    </template>
    <template id="selectFreeText">
      <label class="free-text">
        <span>Please specify</span>
        <input type="text" name="" />
      </label>
    </template>
  </main>
  <footer>
    <div class="progress hidden">
      <label for="progress"></label>
      <progress id="progress" max="100" value=""></progress>
    </div>
  </footer>
  <script defer src="https://unpkg.com/dayjs@1.11.5/dayjs.min.js"></script>
  <script defer type="module">
    import { logEvent } from 'https://www.gstatic.com/firebasejs/9.9.3/firebase-analytics.js'
    import { analytics, getLink, initMenu } from '../_scripts/init.js?v=1'
    import { initialise } from '../_scripts/survey.js'

    const link = await getLink()
    const suveryKey = 'wp-three-two'
    const localSubmissions= JSON.parse(window.localStorage.getItem('submissions')) || []
    
    initialise(suveryKey, localSubmissions)
    logEvent(analytics, 'survey_start', {
      name: `${link.package.name} - ${link.package.survey.title}`,
      user_ref: window.localStorage.getItem('userRef'),
      link_id: link.linkId,
      package_id: link.package.docId,
      time_stamp: dayjs().format('YYYY-MM-DD HH:mm:ssZ')
    });

  </script>
  </body>
</html>