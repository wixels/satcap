<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" media="screen" href="../_style/app.screen.css">
    <link rel="stylesheet" media="screen" href="../_style/survey.screen.css">
    <title>Community Needs Survey</title>
  </head>
  <body>
  <header class="withLink">
    <h1>Community Needs Survey</h1>
    <a href="./exit">&times;</a>
  </header>
  <main>
    <p class="init">Loading...</p>
    <form class="survey hidden" name="survey" action="https://satcap-research.web.app/api/survey" method="POST">
      <input type="hidden" name="survey" value="wp-three-two" />
      <input type="hidden" name="mineDocId" />
      <input type="hidden" name="linkDocId" />
      <input type="hidden" name="linkId" />
      <div class="question">
        
      </div>
      <button type="submit">Submit</button>
    </form>
    <template id="modal">
      <div class="modal close">
        <embed />
      </div>
    </template>
    <template id="selectFreeText">
      <label class="free-text">
        <span>Please specify</span>
        <input type="text" name="" />
      </label>
    </template>
  </main>
  <footer>
    <div class="progress">
      <label for="progress"></label>
      <progress id="progress" max="100" value=""></progress>
    </div>
  </footer>
  <script defer src="https://unpkg.com/dayjs@1.11.5/dayjs.min.js"></script>
  <script defer type="module">
    import { logEvent } from 'https://www.gstatic.com/firebasejs/9.9.3/firebase-analytics.js'
    import { analytics, getLink, initMenu } from '../_scripts/init.js'
    import { initialise } from '../_scripts/survey.js'

    const link = await getLink()
    const suveryKey = 'wp-two-two'
    const localSubmissions= JSON.parse(window.localStorage.getItem('submissions')) || []
    
    initialise(suveryKey, localSubmissions)
    logEvent(analytics, 'survey_start', {
      name: `${link.package.name} - ${link.package.survey.title}`,
      user_ref: window.localStorage.getItem('userRef'),
      link_id: link.linkId,
      package_id: link.package.docId,
      time_stamp: dayjs().format('YYYY-MM-DD HH:mm:ssZ')
    });

  </script>
  </body>
</html>